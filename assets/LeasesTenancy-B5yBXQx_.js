import{r as f,_ as U,k as I,R as l,e as k,P as u,j as e,a as q,C as O}from"./index-Do1h-Tix.js";import{C as B,a as V}from"./CCardBody-Cii54MSL.js";import{C as z}from"./CCardHeader-VU6U-cd3.js";import{C as G}from"./CForm-C2IXiCrW.js";import{C as d,a as s}from"./CRow-DTl0GnMD.js";import{C as _}from"./CFormSelect-YY2vAg8t.js";import{a as w,b as R}from"./CFormControlWrapper-CJhkql4o.js";import{C as h}from"./CFormInput-Cehz8S6i.js";import{C as H}from"./CFormTextarea-BQAjG4N8.js";const g=f.forwardRef((p,r)=>{var{className:c,button:o,feedback:E,feedbackInvalid:y,feedbackValid:A,floatingLabel:T,tooltipFeedback:D,hitArea:m,id:x,indeterminate:b,inline:L,invalid:C,label:t,reverse:n,type:a="checkbox",valid:i}=p,v=U(p,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]);const j=f.useRef(null),N=I(r,j);f.useEffect(()=>{j.current&&b&&(j.current.indeterminate=b)},[b,j.current]);const F=()=>l.createElement("input",Object.assign({type:a,className:k(o?"btn-check":"form-check-input",{"is-invalid":C,"is-valid":i,"me-2":m}),id:x},v,{ref:N})),S=()=>l.createElement(R,{describedby:v["aria-describedby"],feedback:E,feedbackInvalid:y,feedbackValid:A,floatingLabel:T,invalid:C,tooltipFeedback:D,valid:i}),P=()=>l.createElement(w,Object.assign({customClassName:k(o?k("btn",o.variant?`btn-${o.variant}-${o.color}`:`btn-${o.color}`,{[`btn-${o.size}`]:o.size},`${o.shape}`):"form-check-label")},x&&{htmlFor:x}),t),$=()=>o?l.createElement(l.Fragment,null,l.createElement(F,null),t&&l.createElement(P,null),l.createElement(S,null)):t?m?l.createElement(l.Fragment,null,l.createElement(F,null),l.createElement(w,Object.assign({customClassName:k("form-check-label stretched-link",c)},x&&{htmlFor:x}),t),l.createElement(S,null)):l.createElement("div",{className:k("form-check",{"form-check-inline":L,"form-check-reverse":n,"is-invalid":C,"is-valid":i},c)},l.createElement(F,null),l.createElement(P,null),l.createElement(S,null)):l.createElement(F,null);return l.createElement($,null)});g.propTypes=Object.assign({button:u.object,className:u.string,hitArea:u.oneOf(["full"]),id:u.string,indeterminate:u.bool,inline:u.bool,label:u.oneOfType([u.string,u.node]),reverse:u.bool,type:u.oneOf(["checkbox","radio"])},R.propTypes);g.displayName="CFormCheck";const te=()=>{const p="https://condoease-backends.onrender.com",[r,c]=f.useState({property:"",leaseUnits:!1,unit:"",rentPrice:"",depositPrice:"",tenant:"",tenantEmail:"",startDate:"",endDate:"",leaseDocuments:[],tenancyTerms:"",bills:{gas:!1,electricity:!1,internet:!1,tax:!1}}),[o,E]=f.useState([]),[y,A]=f.useState([]),[T,D]=f.useState([]);f.useEffect(()=>{(async()=>{try{const[n,a,i]=await Promise.all([fetch(`${p}/api/properties`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),fetch(`${p}/api/property-units/vacant`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),fetch(`${p}/api/tenants`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})]),v=await n.json(),j=await a.json(),N=await i.json();E(Array.isArray(v)?v:[]),A(Array.isArray(j)?j:[]),D(Array.isArray(N)?N:[])}catch(n){console.error("Error fetching data:",n),E([]),A([]),D([])}})()},[p]);const m=t=>{const{name:n,value:a}=t.target;c(i=>({...i,[n]:a,...n==="property"&&{unit:""}}))},x=t=>{const{name:n,checked:a}=t.target;c(i=>({...i,[n]:a,...n==="leaseUnits"&&{unit:""}}))},b=t=>{const{name:n,checked:a}=t.target;c(i=>({...i,bills:{...i.bills,[n]:a}}))},L=t=>{const n=Array.from(t.target.files);c(a=>({...a,leaseDocuments:n}))},C=async t=>{t.preventDefault();const n=new FormData;Object.keys(r).forEach(a=>{a==="bills"?Object.keys(r.bills).forEach(i=>{n.append(`bills[${i}]`,r.bills[i])}):a==="leaseDocuments"?r.leaseDocuments.forEach(i=>n.append("leaseDocuments",i)):a==="property"?n.append("property_id",r[a]):a==="unit"?n.append("property_unit_id",r[a]):a==="tenant"?n.append("tenant_id",r[a]):n.append(a,r[a])});try{const a=await fetch(`${p}/api/leases`,{method:"POST",body:n,headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!a.ok)throw new Error(await a.text());alert("Lease created successfully!"),c({property:"",leaseUnits:!1,unit:"",rentPrice:"",depositPrice:"",tenant:"",tenantEmail:"",startDate:"",endDate:"",leaseDocuments:[],tenancyTerms:"",bills:{gas:!1,electricity:!1,internet:!1,tax:!1}})}catch(a){console.error(a),alert("Error creating lease.")}};return e.jsxs(q,{className:"mt-5",children:[e.jsx("h4",{className:"mb-4",children:"Create New Lease"}),e.jsxs(B,{children:[e.jsx(z,{children:e.jsx("strong",{children:"Lease Information"})}),e.jsx(V,{children:e.jsxs(G,{onSubmit:C,children:[e.jsxs(d,{className:"mb-3",children:[e.jsx(s,{md:6,children:e.jsxs(_,{name:"property",value:r.property,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:"Select Property/Building"}),o.map(t=>e.jsx("option",{value:t.property_id,children:t.property_name},t.property_id))]})}),e.jsx(s,{md:6,children:e.jsx(g,{type:"checkbox",name:"leaseUnits",label:"Lease Units",checked:r.leaseUnits,onChange:x})})]}),r.leaseUnits&&e.jsx(d,{className:"mb-3",children:e.jsx(s,{md:12,children:e.jsxs(_,{name:"unit",value:r.unit,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:"Select Unit"}),Array.isArray(y)&&y.filter(t=>Number(t.property_id)===Number(r.property)&&String(t.status).toLowerCase()==="vacant").map(t=>e.jsxs("option",{value:t.id,children:[t.unit_number," - ",t.unit_type]},t.id)),console.log("Filtered Units:",y.filter(t=>Number(t.property_id)===Number(r.property)&&t.status.toLowerCase()==="vacant"))]})})}),e.jsxs(d,{className:"mb-3",children:[e.jsx(s,{md:6,children:e.jsx(h,{type:"number",name:"rentPrice",placeholder:"Rent Price (₱)",value:r.rentPrice,onChange:m,required:!0})}),e.jsx(s,{md:6,children:e.jsx(h,{type:"number",name:"depositPrice",placeholder:"Deposit Price (₱)",value:r.depositPrice,onChange:m,required:!0})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(s,{md:6,children:e.jsxs(_,{name:"tenant",value:r.tenant,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:"Select Tenant"}),T.map(t=>e.jsxs("option",{value:t.tenant_id,children:[t.first_name," ",t.last_name]},t.tenant_id))]})}),e.jsx(s,{md:6,children:e.jsx(h,{type:"email",name:"tenantEmail",placeholder:"Tenant Email",value:r.tenantEmail,onChange:m,required:!0})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx("strong",{children:"Start of Lease Date"}),e.jsx(h,{type:"date",name:"startDate",placeholder:"Start Date of Lease",value:r.startDate,onChange:m,required:!0})]}),e.jsxs(s,{md:6,children:[e.jsx("strong",{children:"End of Lease Date"}),e.jsx(h,{type:"date",name:"endDate",placeholder:"End Date of Lease",value:r.endDate,onChange:m,required:!0})]})]}),e.jsx(d,{className:"mb-3",children:e.jsxs(s,{md:12,children:[e.jsx("strong",{children:"Upload Lease Documents"}),e.jsx(h,{type:"file",name:"leaseDocuments",multiple:!0,onChange:L,accept:".jpg,.png,.pdf",required:!0}),e.jsx("small",{className:"text-muted",children:"Accepted formats: jpg, png, pdf."})]})}),e.jsx(d,{className:"mb-3",children:e.jsx(s,{md:12,children:e.jsx(H,{name:"tenancyTerms",placeholder:"Tenancy Terms",rows:"3",value:r.tenancyTerms,onChange:m,required:!0})})}),e.jsx(d,{className:"mb-3",children:e.jsxs(s,{md:12,children:[e.jsx("strong",{children:"Bills"}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(s,{md:6,children:e.jsx(g,{type:"checkbox",name:"gas",label:"Gas",checked:r.bills.gas,onChange:b})}),e.jsx(s,{md:6,children:e.jsx(h,{type:"number",name:"gasAmount",placeholder:"Amount (₱)",value:r.bills.gasAmount||"",onChange:t=>{const n=t.target.value;n>=0&&c(a=>({...a,bills:{...a.bills,gasAmount:n}}))},min:"0"})})]}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(s,{md:6,children:e.jsx(g,{type:"checkbox",name:"electricity",label:"Electricity",checked:r.bills.electricity,onChange:b})}),e.jsx(s,{md:6,children:e.jsx(h,{type:"number",name:"electricityAmount",placeholder:"Amount (₱)",value:r.bills.electricityAmount||"",onChange:t=>{const n=t.target.value;n>=0&&c(a=>({...a,bills:{...a.bills,electricityAmount:n}}))},min:"0"})})]}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(s,{md:6,children:e.jsx(g,{type:"checkbox",name:"internet",label:"Internet",checked:r.bills.internet,onChange:b})}),e.jsx(s,{md:6,children:e.jsx(h,{type:"number",name:"internetAmount",placeholder:"Amount (₱)",value:r.bills.internetAmount||"",onChange:t=>{const n=t.target.value;n>=0&&c(a=>({...a,bills:{...a.bills,internetAmount:n}}))},min:"0"})})]}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(s,{md:6,children:e.jsx(g,{type:"checkbox",name:"tax",label:"Tax",checked:r.bills.tax,onChange:b})}),e.jsx(s,{md:6,children:e.jsx(h,{type:"number",name:"taxAmount",placeholder:"Amount (₱)",value:r.bills.taxAmount||"",onChange:t=>{const n=t.target.value;n>=0&&c(a=>({...a,bills:{...a.bills,taxAmount:n}}))},min:"0"})})]})]})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(O,{type:"submit",style:{backgroundColor:"#F28D35",color:"white",fontWeight:"bold"},children:"Create Lease"})})]})})]})]})};export{te as default};
