import{r as f,_ as I,k as $,R as i,e as k,P as m,j as e,a as O,C as B}from"./index-DtjgaTsV.js";import{C as q,a as V}from"./CCardBody-Ddnl4jTI.js";import{C as z}from"./CCardHeader-BCs9xcg5.js";import{C as G}from"./CForm-CoSso68y.js";import{C as d,a as l}from"./CRow-Jwjei9yu.js";import{C as L}from"./CFormSelect-Brdlzn9r.js";import{a as R,b as U}from"./CFormControlWrapper-Bb8X95Q3.js";import{C as h}from"./CFormInput-DLaFnBSV.js";import{C as H}from"./CFormTextarea-BQvV6Hru.js";const g=f.forwardRef((p,s)=>{var{className:c,button:o,feedback:E,feedbackInvalid:A,feedbackValid:D,floatingLabel:N,tooltipFeedback:F,hitArea:u,id:x,indeterminate:b,inline:T,invalid:v,label:y,reverse:P,type:n="checkbox",valid:a}=p,t=I(p,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]);const r=f.useRef(null),S=$(s,r);f.useEffect(()=>{r.current&&b&&(r.current.indeterminate=b)},[b,r.current]);const j=()=>i.createElement("input",Object.assign({type:n,className:k(o?"btn-check":"form-check-input",{"is-invalid":v,"is-valid":a,"me-2":u}),id:x},t,{ref:S})),C=()=>i.createElement(U,{describedby:t["aria-describedby"],feedback:E,feedbackInvalid:A,feedbackValid:D,floatingLabel:N,invalid:v,tooltipFeedback:F,valid:a}),w=()=>i.createElement(R,Object.assign({customClassName:k(o?k("btn",o.variant?`btn-${o.variant}-${o.color}`:`btn-${o.color}`,{[`btn-${o.size}`]:o.size},`${o.shape}`):"form-check-label")},x&&{htmlFor:x}),y),_=()=>o?i.createElement(i.Fragment,null,i.createElement(j,null),y&&i.createElement(w,null),i.createElement(C,null)):y?u?i.createElement(i.Fragment,null,i.createElement(j,null),i.createElement(R,Object.assign({customClassName:k("form-check-label stretched-link",c)},x&&{htmlFor:x}),y),i.createElement(C,null)):i.createElement("div",{className:k("form-check",{"form-check-inline":T,"form-check-reverse":P,"is-invalid":v,"is-valid":a},c)},i.createElement(j,null),i.createElement(w,null),i.createElement(C,null)):i.createElement(j,null);return i.createElement(_,null)});g.propTypes=Object.assign({button:m.object,className:m.string,hitArea:m.oneOf(["full"]),id:m.string,indeterminate:m.bool,inline:m.bool,label:m.oneOfType([m.string,m.node]),reverse:m.bool,type:m.oneOf(["checkbox","radio"])},U.propTypes);g.displayName="CFormCheck";const te=()=>{const p="https://condoease-backends.onrender.com",[s,c]=f.useState({property:"",leaseUnits:!1,unit:"",rentPrice:"",depositPrice:"",tenant:"",tenantEmail:"",startDate:"",endDate:"",leaseDocuments:[],tenancyTerms:"",bills:{gas:!1,electricity:!1,internet:!1,tax:!1}}),[o,E]=f.useState([]),[A,D]=f.useState([]),[N,F]=f.useState([]);f.useEffect(()=>{(async()=>{try{const[a,t,r]=await Promise.all([fetch(`${p}/api/properties`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),fetch(`${p}/api/property-units/vacant`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),fetch(`${p}/api/tenants`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})]),S=await a.json(),j=await t.json(),C=await r.json();E(Array.isArray(S)?S:[]),D(Array.isArray(j)?j:[]),F(Array.isArray(C)?C:[])}catch(a){console.error("Error fetching data:",a),E([]),D([]),F([])}})()},[p]);const u=n=>{const{name:a,value:t}=n.target;c(r=>({...r,[a]:t,...a==="property"&&{unit:""}}))},x=n=>{const{name:a,checked:t}=n.target;c(r=>({...r,[a]:t,...a==="leaseUnits"&&{unit:""}}))},b=n=>{const{name:a,checked:t}=n.target;c(r=>({...r,bills:{...r.bills,[a]:t}}))},T=n=>{const a=Array.from(n.target.files);c(t=>({...t,leaseDocuments:a}))},v=n=>{const a=n.target.value;c(r=>({...r,unit:a}));const t=A.find(r=>String(r.id)===String(a));t&&c(r=>({...r,unit:a,rentPrice:t.rent_price}))},y=n=>{const a=n.target.value;c(r=>({...r,tenant:a}));const t=N.find(r=>String(r.tenant_id)===String(a));t&&c(r=>({...r,tenantEmail:t.email}))},P=async n=>{n.preventDefault();const a=new FormData;Object.keys(s).forEach(t=>{t==="bills"?Object.keys(s.bills).forEach(r=>{a.append(`bills[${r}]`,s.bills[r])}):t==="leaseDocuments"?s.leaseDocuments.forEach(r=>a.append("leaseDocuments",r)):t==="property"?a.append("property_id",s[t]):t==="unit"?a.append("property_unit_id",s[t]):t==="tenant"?a.append("tenant_id",s[t]):a.append(t,s[t])});try{const t=await fetch(`${p}/api/leases`,{method:"POST",body:a,headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!t.ok)throw new Error(await t.text());alert("Lease created successfully!"),c({property:"",leaseUnits:!1,unit:"",rentPrice:"",depositPrice:"",tenant:"",tenantEmail:"",startDate:"",endDate:"",leaseDocuments:[],tenancyTerms:"",bills:{gas:!1,electricity:!1,internet:!1,tax:!1}})}catch(t){console.error(t),alert("Error creating lease.")}};return e.jsxs(O,{className:"mt-5",children:[e.jsx("h4",{className:"mb-4",children:"Create New Lease"}),e.jsxs(q,{children:[e.jsx(z,{children:e.jsx("strong",{children:"Lease Information"})}),e.jsx(V,{children:e.jsxs(G,{onSubmit:P,children:[e.jsxs(d,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(L,{name:"property",value:s.property,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Property/Building"}),o.map(n=>e.jsx("option",{value:n.id,children:n.property_name},n.id))]})}),e.jsx(l,{md:6,children:e.jsx(g,{type:"checkbox",name:"leaseUnits",label:"Lease Units",checked:s.leaseUnits,onChange:x})})]}),s.leaseUnits&&e.jsx(d,{className:"mb-3",children:e.jsx(l,{md:12,children:e.jsxs(L,{name:"unit",value:s.unit,onChange:v,required:!0,children:[e.jsx("option",{value:"",children:"Select Unit"}),A.filter(n=>String(n.property_id)===String(s.property)&&n.status.toLowerCase()==="vacant").map(n=>e.jsxs("option",{value:n.id,children:[n.unit_number," - ",n.unit_type]},n.id))]})})}),e.jsxs(d,{className:"mb-3",children:[e.jsxs(l,{md:6,children:[e.jsx("strong",{children:"Rent Price (₱)"}),e.jsx(h,{type:"number",name:"rentPrice",placeholder:"Rent Price (₱)",value:s.rentPrice,onChange:u,required:!0})]}),e.jsxs(l,{md:6,children:[e.jsx("strong",{children:"Deposit Price (₱)"}),e.jsx(h,{type:"number",name:"depositPrice",placeholder:"Deposit Price (₱)",value:s.depositPrice,onChange:u,required:!0})]})]}),e.jsxs(d,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(L,{name:"tenant",value:s.tenant,onChange:y,children:[e.jsx("option",{value:"",children:"Select tenant"}),N.map(n=>e.jsxs("option",{value:n.id,children:[n.first_name," ",n.last_name]},n.id))]})}),e.jsx(l,{md:6,children:e.jsx(h,{type:"email",name:"tenantEmail",placeholder:"Tenant Email",value:s.tenantEmail,readOnly:!0})})]}),e.jsxs(d,{className:"mb-3",children:[e.jsxs(l,{md:6,children:[e.jsx("strong",{children:"Start of Lease Date"}),e.jsx(h,{type:"date",name:"startDate",placeholder:"Start Date of Lease",value:s.startDate,onChange:u,required:!0})]}),e.jsxs(l,{md:6,children:[e.jsx("strong",{children:"End of Lease Date"}),e.jsx(h,{type:"date",name:"endDate",placeholder:"End Date of Lease",value:s.endDate,onChange:u,required:!0})]})]}),e.jsx(d,{className:"mb-3",children:e.jsxs(l,{md:12,children:[e.jsx("strong",{children:"Upload Lease Document"}),e.jsx(h,{type:"file",name:"leaseDocuments",multiple:!0,onChange:T,accept:".jpg,.png,.pdf",required:!0}),e.jsx("small",{className:"text-muted",children:"Accepted formats: jpg, png, pdf."})]})}),e.jsx(d,{className:"mb-3",children:e.jsx(l,{md:12,children:e.jsx(H,{name:"tenancyTerms",placeholder:"Tenancy Terms",rows:"3",value:s.tenancyTerms,onChange:u,required:!0})})}),e.jsx(d,{className:"mb-3",children:e.jsxs(l,{md:12,children:[e.jsx("strong",{children:"Bills"}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(l,{md:6,children:e.jsx(g,{type:"checkbox",name:"gas",label:"Gas",checked:s.bills.gas,onChange:b})}),e.jsx(l,{md:6,children:e.jsx(h,{type:"number",name:"gasAmount",placeholder:"Amount (₱)",value:s.bills.gasAmount||"",onChange:n=>{const a=n.target.value;a>=0&&c(t=>({...t,bills:{...t.bills,gasAmount:a}}))},min:"0"})})]}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(l,{md:6,children:e.jsx(g,{type:"checkbox",name:"electricity",label:"Electricity",checked:s.bills.electricity,onChange:b})}),e.jsx(l,{md:6,children:e.jsx(h,{type:"number",name:"electricityAmount",placeholder:"Amount (₱)",value:s.bills.electricityAmount||"",onChange:n=>{const a=n.target.value;a>=0&&c(t=>({...t,bills:{...t.bills,electricityAmount:a}}))},min:"0"})})]}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(l,{md:6,children:e.jsx(g,{type:"checkbox",name:"internet",label:"Internet",checked:s.bills.internet,onChange:b})}),e.jsx(l,{md:6,children:e.jsx(h,{type:"number",name:"internetAmount",placeholder:"Amount (₱)",value:s.bills.internetAmount||"",onChange:n=>{const a=n.target.value;a>=0&&c(t=>({...t,bills:{...t.bills,internetAmount:a}}))},min:"0"})})]}),e.jsxs(d,{className:"align-items-center mb-2",children:[e.jsx(l,{md:6,children:e.jsx(g,{type:"checkbox",name:"tax",label:"Tax",checked:s.bills.tax,onChange:b})}),e.jsx(l,{md:6,children:e.jsx(h,{type:"number",name:"taxAmount",placeholder:"Amount (₱)",value:s.bills.taxAmount||"",onChange:n=>{const a=n.target.value;a>=0&&c(t=>({...t,bills:{...t.bills,taxAmount:a}}))},min:"0"})})]})]})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(B,{type:"submit",style:{backgroundColor:"#F28D35",color:"white",fontWeight:"bold"},children:"Create Lease"})})]})})]})]})};export{te as default};
