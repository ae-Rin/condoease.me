import{r as u,_ as R,k as I,R as l,e as v,P as d,j as e,a as q,C as O}from"./index-DMdMzUr9.js";import{C as B,a as V}from"./CCardBody-CUhezjej.js";import{C as z}from"./CCardHeader-DpMSYA3O.js";import{C as H}from"./CForm-BmLJMM-g.js";import{C as p,a as o}from"./CRow-DDz2JyRz.js";import{C as _}from"./CFormSelect-DUdOrm_j.js";import{a as P,b as $}from"./CFormControlWrapper-4UYghSX6.js";import{C as x}from"./CFormInput-BVQ5FRhx.js";import{C as W}from"./CFormTextarea-3AA7dxHp.js";const A=u.forwardRef((h,r)=>{var{className:m,button:c,feedback:k,feedbackInvalid:g,feedbackValid:E,floatingLabel:T,tooltipFeedback:D,hitArea:F,id:i,indeterminate:y,inline:S,invalid:C,label:j,reverse:t,type:n="checkbox",valid:a}=h,s=R(h,["className","button","feedback","feedbackInvalid","feedbackValid","floatingLabel","tooltipFeedback","hitArea","id","indeterminate","inline","invalid","label","reverse","type","valid"]);const f=u.useRef(null),N=I(r,f);u.useEffect(()=>{f.current&&y&&(f.current.indeterminate=y)},[y,f.current]);const b=()=>l.createElement("input",Object.assign({type:n,className:v(c?"btn-check":"form-check-input",{"is-invalid":C,"is-valid":a,"me-2":F}),id:i},s,{ref:N})),U=()=>l.createElement($,{describedby:s["aria-describedby"],feedback:k,feedbackInvalid:g,feedbackValid:E,floatingLabel:T,invalid:C,tooltipFeedback:D,valid:a}),L=()=>l.createElement(P,Object.assign({customClassName:v(c?v("btn",c.variant?`btn-${c.variant}-${c.color}`:`btn-${c.color}`,{[`btn-${c.size}`]:c.size},`${c.shape}`):"form-check-label")},i&&{htmlFor:i}),j),w=()=>c?l.createElement(l.Fragment,null,l.createElement(b,null),j&&l.createElement(L,null),l.createElement(U,null)):j?F?l.createElement(l.Fragment,null,l.createElement(b,null),l.createElement(P,Object.assign({customClassName:v("form-check-label stretched-link",m)},i&&{htmlFor:i}),j),l.createElement(U,null)):l.createElement("div",{className:v("form-check",{"form-check-inline":S,"form-check-reverse":t,"is-invalid":C,"is-valid":a},m)},l.createElement(b,null),l.createElement(L,null),l.createElement(U,null)):l.createElement(b,null);return l.createElement(w,null)});A.propTypes=Object.assign({button:d.object,className:d.string,hitArea:d.oneOf(["full"]),id:d.string,indeterminate:d.bool,inline:d.bool,label:d.oneOfType([d.string,d.node]),reverse:d.bool,type:d.oneOf(["checkbox","radio"])},$.propTypes);A.displayName="CFormCheck";const te=()=>{const h="https://condoease-backends.onrender.com",[r,m]=u.useState({property:"",leaseUnits:!1,unit:"",rentPrice:"",depositPrice:"",tenant:"",tenantEmail:"",startDate:"",endDate:"",leaseDocuments:[],tenancyTerms:"",bills:{gas:!1,electricity:!1,internet:!1,tax:!1}}),[c,k]=u.useState([]),[g,E]=u.useState([]),[T,D]=u.useState([]);u.useEffect(()=>{(async()=>{try{const[n,a,s]=await Promise.all([fetch(`${h}/api/properties`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),fetch(`${h}/api/property-units/vacant`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),fetch(`${h}/api/tenants`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})]),f=await n.json(),N=await a.json(),b=await s.json();k(Array.isArray(f)?f:[]),E(Array.isArray(N)?N:[]),D(Array.isArray(b)?b:[])}catch(n){console.error("Error fetching data:",n),k([]),E([]),D([])}})()},[h]);const F=r.leaseUnits&&r.property?g.filter(t=>t.property_id===r.property&&t.status.toLowerCase()==="vacant"):[];u.useEffect(()=>{if(r.leaseUnits&&r.property){const t=g.filter(n=>String(n.property_id).trim()===String(r.property).trim()&&n.status.toLowerCase()==="vacant");console.log("Selected property:",r.property),console.log("Filtered Units:",t)}},[g,r.property,r.leaseUnits]);const i=t=>{const{name:n,value:a}=t.target;m(s=>({...s,[n]:n==="property"?Number(a):a,...n==="property"&&{unit:""}}))},y=t=>{const{name:n,checked:a}=t.target;m(s=>({...s,[n]:a,...n==="leaseUnits"&&{unit:""}}))},S=t=>{const{name:n,checked:a}=t.target;m(s=>({...s,bills:{...s.bills,[n]:a}}))},C=t=>{const n=Array.from(t.target.files);m(a=>({...a,leaseDocuments:n}))},j=async t=>{t.preventDefault();const n=new FormData;Object.keys(r).forEach(a=>{a==="bills"?Object.keys(r.bills).forEach(s=>{n.append(`bills[${s}]`,r.bills[s])}):a==="leaseDocuments"?r.leaseDocuments.forEach(s=>n.append("leaseDocuments",s)):a==="property"?n.append("property_id",r[a]):a==="unit"?n.append("property_unit_id",r[a]):a==="tenant"?n.append("tenant_id",r[a]):n.append(a,r[a])});try{const a=await fetch(`${h}/api/leases`,{method:"POST",body:n,headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!a.ok)throw new Error(await a.text());alert("Lease created successfully!"),m({property:"",leaseUnits:!1,unit:"",rentPrice:"",depositPrice:"",tenant:"",tenantEmail:"",startDate:"",endDate:"",leaseDocuments:[],tenancyTerms:"",bills:{gas:!1,electricity:!1,internet:!1,tax:!1}})}catch(a){console.error(a),alert("Error creating lease.")}};return e.jsxs(q,{className:"mt-5",children:[e.jsx("h4",{className:"mb-4",children:"Create New Lease"}),e.jsxs(B,{children:[e.jsx(z,{children:e.jsx("strong",{children:"Lease Information"})}),e.jsx(V,{children:e.jsxs(H,{onSubmit:j,children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(o,{md:6,children:e.jsxs(_,{name:"property",value:r.property,onChange:i,required:!0,children:[e.jsx("option",{value:"",children:"Select Property/Building"}),c.map(t=>e.jsx("option",{value:t.property_id,children:t.property_name},t.property_id))]})}),e.jsx(o,{md:6,children:e.jsx(A,{type:"checkbox",name:"leaseUnits",label:"Lease Units",checked:r.leaseUnits,onChange:y})})]}),r.leaseUnits&&e.jsx(p,{className:"mb-3",children:e.jsx(o,{md:12,children:e.jsxs(_,{name:"unit",value:r.unit,onChange:i,required:!0,children:[e.jsx("option",{value:"",children:"Select Unit"}),F.map(t=>e.jsxs("option",{value:t.id,children:[t.unit_number," - ",t.unit_type]},t.id))]})})}),e.jsxs(p,{className:"mb-3",children:[e.jsx(o,{md:6,children:e.jsx(x,{type:"number",name:"rentPrice",placeholder:"Rent Price (₱)",value:r.rentPrice,onChange:i,required:!0})}),e.jsx(o,{md:6,children:e.jsx(x,{type:"number",name:"depositPrice",placeholder:"Deposit Price (₱)",value:r.depositPrice,onChange:i,required:!0})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(o,{md:6,children:e.jsxs(_,{name:"tenant",value:r.tenant,onChange:i,required:!0,children:[e.jsx("option",{value:"",children:"Select Tenant"}),T.map(t=>e.jsxs("option",{value:t.tenant_id,children:[t.first_name," ",t.last_name]},t.tenant_id))]})}),e.jsx(o,{md:6,children:e.jsx(x,{type:"email",name:"tenantEmail",placeholder:"Tenant Email",value:r.tenantEmail,onChange:i,required:!0})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsxs(o,{md:6,children:[e.jsx("strong",{children:"Start of Lease Date"}),e.jsx(x,{type:"date",name:"startDate",value:r.startDate,onChange:i,required:!0})]}),e.jsxs(o,{md:6,children:[e.jsx("strong",{children:"End of Lease Date"}),e.jsx(x,{type:"date",name:"endDate",value:r.endDate,onChange:i,required:!0})]})]}),e.jsx(p,{className:"mb-3",children:e.jsxs(o,{md:12,children:[e.jsx("strong",{children:"Upload Lease Documents"}),e.jsx(x,{type:"file",name:"leaseDocuments",multiple:!0,onChange:C,accept:".jpg,.png,.pdf",required:!0}),e.jsx("small",{className:"text-muted",children:"Accepted formats: jpg, png, pdf."})]})}),e.jsx(p,{className:"mb-3",children:e.jsx(o,{md:12,children:e.jsx(W,{name:"tenancyTerms",placeholder:"Tenancy Terms",rows:"3",value:r.tenancyTerms,onChange:i,required:!0})})}),e.jsx(p,{className:"mb-3",children:e.jsxs(o,{md:12,children:[e.jsx("strong",{children:"Bills"}),["gas","electricity","internet","tax"].map(t=>e.jsxs(p,{className:"align-items-center mb-2",children:[e.jsx(o,{md:6,children:e.jsx(A,{type:"checkbox",name:t,label:t.charAt(0).toUpperCase()+t.slice(1),checked:r.bills[t],onChange:S})}),e.jsx(o,{md:6,children:e.jsx(x,{type:"number",name:`${t}Amount`,placeholder:"Amount (₱)",value:r.bills[`${t}Amount`]||"",onChange:n=>{const a=n.target.value;a>=0&&m(s=>({...s,bills:{...s.bills,[`${t}Amount`]:a}}))},min:"0"})})]},t))]})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(O,{type:"submit",style:{backgroundColor:"#F28D35",color:"white",fontWeight:"bold"},children:"Create Lease"})})]})})]})]})};export{te as default};
