import{r,_ as S,R as d,d as j,e as P,P as t,g as me,T as ue,h as te,i as fe,k as he,u as pe,c as ve,m as oe,j as e,n as xe,C as N}from"./index-DYpOWHYQ.js";import{C as L,a as M}from"./CRow-C1Dk8C3x.js";import{C as re,a as be}from"./CCardBody-D8PUjH5D.js";import{C as ye}from"./CCardHeader-DL0iqZem.js";import{C as k}from"./CFormInput-B5oQsnVs.js";var G=r.forwardRef(function(a,l){var s=a.children,c=a.className,i=S(a,["children","className"]);return d.createElement("div",j({className:P("modal-content",c)},i,{ref:l}),s)});G.propTypes={children:t.node,className:t.string};G.displayName="CModalContent";var ne=r.createContext({}),J=r.forwardRef(function(a,l){var s,c=a.children,i=a.alignment,u=a.className,h=a.fullscreen,x=a.scrollable,b=a.size,y=S(a,["children","alignment","className","fullscreen","scrollable","size"]);return d.createElement("div",j({className:P("modal-dialog",(s={"modal-dialog-centered":i==="center"},s[typeof h=="boolean"?"modal-fullscreen":"modal-fullscreen-".concat(h,"-down")]=h,s["modal-dialog-scrollable"]=x,s["modal-".concat(b)]=b,s),u)},y,{ref:l}),c)});J.propTypes={alignment:t.oneOf(["top","center"]),children:t.node,className:t.string,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),scrollable:t.bool,size:t.oneOf(["sm","lg","xl"])};J.displayName="CModalDialog";var $=r.forwardRef(function(a,l){var s=a.children,c=a.alignment,i=a.backdrop,u=i===void 0?!0:i,h=a.className,x=a.container,b=a.duration,y=b===void 0?150:b,F=a.focus,R=F===void 0?!0:F,T=a.fullscreen,n=a.keyboard,H=n===void 0?!0:n,p=a.onClose,w=a.onClosePrevented,D=a.onShow,z=a.portal,A=z===void 0?!0:z,q=a.scrollable,B=a.size,o=a.transition,m=o===void 0?!0:o,v=a.unmountOnClose,C=v===void 0?!0:v,E=a.visible,le=S(a,["children","alignment","backdrop","className","container","duration","focus","fullscreen","keyboard","onClose","onClosePrevented","onShow","portal","scrollable","size","transition","unmountOnClose","visible"]),K=r.useRef(null),O=r.useRef(null),ce=r.useRef(null),ie=me(l,O),Q=r.useState(E),g=Q[0],Z=Q[1],X=r.useState(!1),Y=X[0],_=X[1],de={visible:g,setVisible:Z};r.useEffect(function(){Z(E)},[E]),r.useEffect(function(){var f;return g?(K.current=document.activeElement,document.addEventListener("mouseup",se),document.addEventListener("keydown",ae)):(f=K.current)===null||f===void 0||f.focus(),function(){document.removeEventListener("mouseup",se),document.removeEventListener("keydown",ae)}},[g]);var ee=function(){if(u==="static")return _(!0);Z(!1)};r.useLayoutEffect(function(){w&&w(),setTimeout(function(){return _(!1)},y)},[Y]),r.useLayoutEffect(function(){return g?(document.body.classList.add("modal-open"),u&&(document.body.style.overflow="hidden",document.body.style.paddingRight="0px"),setTimeout(function(){var f;R&&((f=O.current)===null||f===void 0||f.focus())},m?y:0)):(document.body.classList.remove("modal-open"),u&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))),function(){document.body.classList.remove("modal-open"),u&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))}},[g]);var se=function(f){O.current&&O.current==f.target&&ee()},ae=function(f){f.key==="Escape"&&H&&ee()};return d.createElement(d.Fragment,null,d.createElement(ue,{in:g,mountOnEnter:!0,nodeRef:O,onEnter:D,onExit:p,unmountOnExit:C,timeout:m?y:0},function(f){return d.createElement(te,{container:x,portal:A},d.createElement(ne.Provider,{value:de},d.createElement("div",j({className:P("modal",{"modal-static":Y,fade:m,show:f==="entered"},h),tabIndex:-1},g?{"aria-modal":!0,role:"dialog"}:{"aria-hidden":"true"},{style:j({},f!=="exited"&&{display:"block"})},le,{ref:ie}),d.createElement(J,{alignment:c,fullscreen:T,scrollable:q,size:B},d.createElement(G,{ref:ce},s)))))}),u&&d.createElement(te,{container:x,portal:A},d.createElement(fe,{visible:g})))});$.propTypes={alignment:t.oneOf(["top","center"]),backdrop:t.oneOfType([t.bool,t.oneOf(["static"])]),children:t.node,className:t.string,container:t.any,duration:t.number,focus:t.bool,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),keyboard:t.bool,onClose:t.func,onClosePrevented:t.func,onShow:t.func,portal:t.bool,scrollable:t.bool,size:t.oneOf(["sm","lg","xl"]),transition:t.bool,unmountOnClose:t.bool,visible:t.bool};$.displayName="CModal";var W=r.forwardRef(function(a,l){var s=a.children,c=a.className,i=S(a,["children","className"]);return d.createElement("div",j({className:P("modal-body",c)},i,{ref:l}),s)});W.propTypes={children:t.node,className:t.string};W.displayName="CModalBody";var U=r.forwardRef(function(a,l){var s=a.children,c=a.className,i=S(a,["children","className"]);return d.createElement("div",j({className:P("modal-footer",c)},i,{ref:l}),s)});U.propTypes={children:t.node,className:t.string};U.displayName="CModalFooter";var V=r.forwardRef(function(a,l){var s=a.children,c=a.className,i=a.closeButton,u=i===void 0?!0:i,h=S(a,["children","className","closeButton"]),x=r.useContext(ne).setVisible;return d.createElement("div",j({className:P("modal-header",c)},h,{ref:l}),s,u&&d.createElement(he,{onClick:function(){return x(!1)}}))});V.propTypes={children:t.node,className:t.string,closeButton:t.bool};V.displayName="CModalHeader";var I=r.forwardRef(function(a,l){var s=a.children,c=a.as,i=c===void 0?"h5":c,u=a.className,h=S(a,["children","as","className"]);return d.createElement(i,j({className:P("modal-title",u)},h,{ref:l}),s)});I.propTypes={as:t.elementType,children:t.node,className:t.string};I.displayName="CModalTitle";const Ce=({visible:a,field:l,tempData:s,setTempData:c,onClose:i,onSave:u})=>{const h=l.charAt(0).toUpperCase()+l.slice(1),[x,b]=r.useState(!1),[y,F]=r.useState(!1),[R,T]=r.useState(!1);return e.jsxs($,{visible:a,onClose:i,children:[e.jsx(V,{children:e.jsxs(I,{children:["Edit ",h]})}),e.jsxs(W,{children:[l==="name"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"First Name"}),e.jsx(k,{className:"mb-2",value:s.firstName||"",onChange:n=>c({...s,firstName:n.target.value})}),e.jsx("label",{children:"Last Name"}),e.jsx(k,{value:s.lastName||"",onChange:n=>c({...s,lastName:n.target.value})})]}),l==="email"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Email"}),e.jsx(k,{className:"mb-2",value:s.email||"",onChange:n=>c({...s,email:n.target.value})}),e.jsx("label",{children:"Password (for verification)"}),e.jsx(k,{type:"password",value:s.password||"",onChange:n=>c({...s,password:n.target.value})})]}),l==="password"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Current Password"}),e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(k,{type:x?"text":"password",value:s.current||"",onChange:n=>c({...s,current:n.target.value})}),e.jsx(N,{style:{fontWeight:"bold"},color:"secondary",size:"sm",className:"ms-2",onClick:()=>b(n=>!n),children:x?"Hide":"Show"})]}),e.jsx("label",{children:"New Password"}),e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(k,{type:y?"text":"password",value:s.new||"",onChange:n=>c({...s,new:n.target.value})}),e.jsx(N,{style:{fontWeight:"bold"},color:"secondary",size:"sm",className:"ms-2",onClick:()=>F(n=>!n),children:y?"Hide":"Show"})]}),e.jsx("label",{children:"Re-type New Password"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(k,{type:R?"text":"password",value:s.confirm||"",onChange:n=>c({...s,confirm:n.target.value})}),e.jsx(N,{style:{fontWeight:"bold"},color:"secondary",size:"sm",className:"ms-2",onClick:()=>T(n=>!n),children:R?"Hide":"Show"})]})]})]}),e.jsxs(U,{children:[e.jsx(N,{style:{fontWeight:"bold"},color:"secondary",onClick:i,children:"Cancel"}),e.jsx(N,{style:{backgroundColor:"#F28D35",fontWeight:"bold",color:"white"},onClick:u,children:"Save Changes"})]})]})},Ne=({visible:a,onClose:l,onConfirm:s})=>e.jsxs($,{visible:a,onClose:l,children:[e.jsx(V,{children:e.jsx(I,{children:"Confirm Account Deletion"})}),e.jsx(W,{children:"Are you sure you want to delete your account? This action cannot be undone."}),e.jsxs(U,{children:[e.jsx(N,{style:{fontWeight:"bold"},color:"secondary",onClick:l,children:"Cancel"}),e.jsx(N,{style:{fontWeight:"bold",color:"white"},color:"danger",onClick:s,children:"Delete Account"})]})]}),Se=()=>{var B;const a=r.useRef(null),l=pe(),{user:s,setUser:c}=ve(),i=(B=s==null?void 0:s.avatar)!=null&&B.startsWith("/uploads/")?`http://localhost:5000${s.avatar}`:oe,[u,h]=r.useState({}),[x,b]=r.useState(!1),[y,F]=r.useState(i),[R,T]=r.useState(!1),[n,H]=r.useState(""),[p,w]=r.useState({});r.useEffect(()=>{s&&h(s)},[s]);const D=async o=>{const m=o.target.files[0];if(!m)return;const v=new FormData;v.append("avatar",m);try{const C=await fetch("http://localhost:5000/api/users/avatar",{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:v}),E=await C.json();C.ok&&E.avatar?(c({...s,avatar:E.avatar}),alert("Profile Updated!")):alert("Failed to update avatar.")}catch(C){console.error("Avatar upload error:",C),alert("Failed to update avatar.")}},z=o=>{H(o),o==="name"&&w({firstName:s.firstName,lastName:s.lastName}),o==="email"&&w({email:s.email,password:""}),o==="password"&&w({current:"",new:"",confirm:""}),b(!0)},A=async()=>{let o={};if(n==="name"){if(!p.firstName||!p.lastName)return alert("First name and last name are required.");o={firstName:p.firstName,lastName:p.lastName}}else if(n==="email"){if(!p.email||!p.password)return alert("Both email and password are required.");o={email:p.email,password:p.password}}else if(n==="password"){const{current:m,new:v,confirm:C}=p;if(!m||!v||!C)return alert("All password fields are required.");if(v!==C)return alert("New password and confirmation do not match.");if(!/^(?=.*[A-Za-z])(?=.*\d)(?=.*[!$@%])[A-Za-z\d!$@%]{8,}$/.test(v))return alert("Password must be at least 8 characters and include letters, numbers, and special characters (!$@%).");o={currentPassword:m,password:v}}try{const m=await fetch(`http://localhost:5000/api/users/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(o)}),v=await m.json();m.ok?(c({...s,...o}),document.activeElement.blur(),b(!1),alert("Profile updated successfully!")):alert("Error updating account: "+v.error)}catch(m){console.error("Error updating account:",m),alert("Failed to update account.")}},q=async()=>{try{const o=await fetch(`/api/users/${s.id}`,{method:"DELETE"}),m=await o.json();o.ok?(localStorage.removeItem("authToken"),l("/login")):alert("Error deleting account: "+m.error)}catch(o){console.error("Error deleting account:",o)}};return e.jsxs("div",{className:"container",style:{padding:"20px"},children:[e.jsx("h4",{className:"mb-3",children:"Account Settings"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-body-secondary text-decoration-none",style:{cursor:"pointer"},onClick:()=>l("/cards"),children:"DASHBOARD"})," / ",e.jsx("span",{style:{color:"#F28D35"},children:"ACCOUNT SETTINGS"})]}),e.jsx(L,{className:"justify-content-start mb-4",children:e.jsx(M,{md:10,children:e.jsx(re,{className:"p-3",children:e.jsxs(L,{className:"align-items-center",children:[e.jsx(M,{xs:"auto",children:e.jsx(xe,{src:i,size:"xl",alt:"Profile",onError:o=>o.target.src=oe})}),e.jsxs(M,{children:[e.jsxs("h5",{className:"mb-1",children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),e.jsx("p",{className:"text-muted mb-0",children:s==null?void 0:s.email})]}),e.jsxs(M,{xs:"auto",className:"text-end",children:[e.jsx("input",{type:"file",accept:"image/*",ref:a,onChange:D,style:{display:"none"}}),e.jsx(N,{style:{fontWeight:"bold",color:"white",backgroundColor:"#F28D35"},size:"sm",onClick:()=>{var o;return(o=a.current)==null?void 0:o.click()},children:"Change Profile Picture"})]})]})})})}),e.jsx(L,{className:"justify-content-start mb-4",children:e.jsx(M,{md:10,children:e.jsxs(re,{children:[e.jsx(ye,{className:"text-body-secondary",children:e.jsx("strong",{children:"Profile Information"})}),e.jsx(be,{children:["name","email","password"].map(o=>e.jsxs("div",{className:"text-body-secondary mb-3 d-flex justify-content-between align-items-center",style:{cursor:"pointer"},onClick:()=>z(o),children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[o.charAt(0).toUpperCase()+o.slice(1),":"]}),e.jsx("p",{className:"mb-0",children:o==="name"?`${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}`:o==="email"?s==null?void 0:s.email:"********"})]}),e.jsx("span",{style:{fontSize:"1.5rem",color:"#adb5bd"},children:"›"})]},o))})]})})}),e.jsx(L,{className:"justify-content-center mt-3",children:e.jsx(M,{md:8,className:"d-flex justify-content-end",children:e.jsx(N,{style:{fontWeight:"bold",color:"white"},color:"danger",onClick:()=>T(!0),children:"Delete Account"})})}),e.jsx(Ce,{visible:x,field:n,tempData:p,setTempData:w,onClose:()=>{var o;(o=document.activeElement)==null||o.blur(),b(!1)},onSave:A}),e.jsx(Ne,{visible:R,onClose:()=>{var o;(o=document.activeElement)==null||o.blur(),T(!1)},onConfirm:q})]})};export{Se as default};
