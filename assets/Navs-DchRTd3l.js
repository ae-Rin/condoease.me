import{r,_ as w,R as m,e as E,P as a,f as _,T as ee,g as J,h as se,i as ae,k as te,u as oe,c as re,l as K,j as e,m as le,C as g}from"./index-D0uWwt9V.js";import{C as z,a as O}from"./CRow-DFVkpUBd.js";import{C as Q,a as ne}from"./CCardBody-C6RRwwb8.js";import{C as ce}from"./CCardHeader-DPaoQ3Sa.js";import{C as v}from"./CFormInput-D-A77Edm.js";import"./CFormControlWrapper-DK15K3Ab.js";const V=r.forwardRef((o,n)=>{var{children:s,className:c}=o,i=w(o,["children","className"]);return m.createElement("div",Object.assign({className:E("modal-content",c)},i,{ref:n}),s)});V.propTypes={children:a.node,className:a.string};V.displayName="CModalContent";const X=r.createContext({}),D=r.forwardRef((o,n)=>{var{children:s,alignment:c,className:i,fullscreen:f,scrollable:p,size:x}=o,b=w(o,["children","alignment","className","fullscreen","scrollable","size"]);return m.createElement("div",Object.assign({className:E("modal-dialog",{"modal-dialog-centered":c==="center",[typeof f=="boolean"?"modal-fullscreen":`modal-fullscreen-${f}-down`]:f,"modal-dialog-scrollable":p,[`modal-${x}`]:x},i)},b,{ref:n}),s)});D.propTypes={alignment:a.oneOf(["top","center"]),children:a.node,className:a.string,fullscreen:a.oneOfType([a.bool,a.oneOf(["sm","md","lg","xl","xxl"])]),scrollable:a.bool,size:a.oneOf(["sm","lg","xl"])};D.displayName="CModalDialog";const B=r.forwardRef((o,n)=>{var{children:s,alignment:c,backdrop:i=!0,className:f,container:p,duration:x=150,focus:b=!0,fullscreen:T,keyboard:F=!0,onClose:k,onClosePrevented:C,onShow:l,portal:M=!0,scrollable:h,size:S,transition:A=!0,unmountOnClose:I=!0,visible:R}=o,H=w(o,["children","alignment","backdrop","className","container","duration","focus","fullscreen","keyboard","onClose","onClosePrevented","onShow","portal","scrollable","size","transition","unmountOnClose","visible"]);const N=r.useRef(null),t=_(n,N),[d,u]=r.useState(R),[y,P]=r.useState(!1),Y={visible:d,setVisible:u};r.useEffect(()=>{u(R)},[R]),r.useEffect(()=>(d&&(document.addEventListener("mouseup",Z),document.addEventListener("keydown",G)),()=>{document.removeEventListener("mouseup",Z),document.removeEventListener("keydown",G)}),[d]);const q=()=>{if(i==="static")return P(!0);u(!1)};r.useLayoutEffect(()=>{C==null||C(),setTimeout(()=>P(!1),x)},[y]),r.useLayoutEffect(()=>(d?(document.body.classList.add("modal-open"),i&&(document.body.style.overflow="hidden",document.body.style.paddingRight="0px")):(document.body.classList.remove("modal-open"),i&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))),()=>{document.body.classList.remove("modal-open"),i&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))}),[d]);const Z=j=>{N.current&&N.current==j.target&&q()},G=j=>{j.key==="Escape"&&F&&q()};return m.createElement(m.Fragment,null,m.createElement(ee,{in:d,mountOnEnter:!0,nodeRef:N,onEnter:l,onExit:k,unmountOnExit:I,timeout:A?x:0},j=>m.createElement(J,{container:p,portal:M},m.createElement(X.Provider,{value:Y},m.createElement(se,{active:b&&j==="entered"},m.createElement("div",Object.assign({className:E("modal",{"modal-static":y,fade:A,show:j==="entered"},f),tabIndex:-1},d?{"aria-modal":!0,role:"dialog"}:{"aria-hidden":"true"},{style:Object.assign({},j!=="exited"&&{display:"block"})},H,{ref:t}),m.createElement(D,{alignment:c,fullscreen:T,scrollable:h,size:S},m.createElement(V,null,s))))))),i&&m.createElement(J,{container:p,portal:M},m.createElement(ae,{visible:d})))});B.propTypes={alignment:a.oneOf(["top","center"]),backdrop:a.oneOfType([a.bool,a.oneOf(["static"])]),children:a.node,className:a.string,container:a.any,duration:a.number,focus:a.bool,fullscreen:a.oneOfType([a.bool,a.oneOf(["sm","md","lg","xl","xxl"])]),keyboard:a.bool,onClose:a.func,onClosePrevented:a.func,onShow:a.func,portal:a.bool,scrollable:a.bool,size:a.oneOf(["sm","lg","xl"]),transition:a.bool,unmountOnClose:a.bool,visible:a.bool};B.displayName="CModal";const $=r.forwardRef((o,n)=>{var{children:s,className:c}=o,i=w(o,["children","className"]);return m.createElement("div",Object.assign({className:E("modal-body",c)},i,{ref:n}),s)});$.propTypes={children:a.node,className:a.string};$.displayName="CModalBody";const L=r.forwardRef((o,n)=>{var{children:s,className:c}=o,i=w(o,["children","className"]);return m.createElement("div",Object.assign({className:E("modal-footer",c)},i,{ref:n}),s)});L.propTypes={children:a.node,className:a.string};L.displayName="CModalFooter";const W=r.forwardRef((o,n)=>{var{children:s,className:c,closeButton:i=!0}=o,f=w(o,["children","className","closeButton"]);const{setVisible:p}=r.useContext(X);return m.createElement("div",Object.assign({className:E("modal-header",c)},f,{ref:n}),s,i&&m.createElement(te,{onClick:()=>p(!1)}))});W.propTypes={children:a.node,className:a.string,closeButton:a.bool};W.displayName="CModalHeader";const U=r.forwardRef((o,n)=>{var{children:s,as:c="h5",className:i}=o,f=w(o,["children","as","className"]);return m.createElement(c,Object.assign({className:E("modal-title",i)},f,{ref:n}),s)});U.propTypes={as:a.elementType,children:a.node,className:a.string};U.displayName="CModalTitle";const ie=({visible:o,field:n,tempData:s,setTempData:c,onClose:i,onSave:f})=>{const p=n.charAt(0).toUpperCase()+n.slice(1),[x,b]=r.useState(!1),[T,F]=r.useState(!1),[k,C]=r.useState(!1);return e.jsxs(B,{visible:o,onClose:i,children:[e.jsx(W,{children:e.jsxs(U,{children:["Edit ",p]})}),e.jsxs($,{children:[n==="name"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"First Name"}),e.jsx(v,{className:"mb-2",value:s.firstName||"",onChange:l=>c({...s,firstName:l.target.value})}),e.jsx("label",{children:"Last Name"}),e.jsx(v,{value:s.lastName||"",onChange:l=>c({...s,lastName:l.target.value})})]}),n==="email"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Email"}),e.jsx(v,{className:"mb-2",value:s.email||"",onChange:l=>c({...s,email:l.target.value})}),e.jsx("label",{children:"Password (for verification)"}),e.jsx(v,{type:"password",value:s.password||"",onChange:l=>c({...s,password:l.target.value})})]}),n==="password"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Current Password"}),e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(v,{type:x?"text":"password",value:s.current||"",onChange:l=>c({...s,current:l.target.value})}),e.jsx(g,{style:{fontWeight:"bold"},color:"secondary",size:"sm",className:"ms-2",onClick:()=>b(l=>!l),children:x?"Hide":"Show"})]}),e.jsx("label",{children:"New Password"}),e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(v,{type:T?"text":"password",value:s.new||"",onChange:l=>c({...s,new:l.target.value})}),e.jsx(g,{style:{fontWeight:"bold"},color:"secondary",size:"sm",className:"ms-2",onClick:()=>F(l=>!l),children:T?"Hide":"Show"})]}),e.jsx("label",{children:"Re-type New Password"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(v,{type:k?"text":"password",value:s.confirm||"",onChange:l=>c({...s,confirm:l.target.value})}),e.jsx(g,{style:{fontWeight:"bold"},color:"secondary",size:"sm",className:"ms-2",onClick:()=>C(l=>!l),children:k?"Hide":"Show"})]})]})]}),e.jsxs(L,{children:[e.jsx(g,{style:{fontWeight:"bold"},color:"secondary",onClick:i,children:"Cancel"}),e.jsx(g,{style:{backgroundColor:"#F28D35",fontWeight:"bold",color:"white"},onClick:f,children:"Save Changes"})]})]})},de=({visible:o,onClose:n,onConfirm:s})=>e.jsxs(B,{visible:o,onClose:n,children:[e.jsx(W,{children:e.jsx(U,{children:"Confirm Account Deletion"})}),e.jsx($,{children:"Are you sure you want to delete your account? This action cannot be undone."}),e.jsxs(L,{children:[e.jsx(g,{style:{fontWeight:"bold"},color:"secondary",onClick:n,children:"Cancel"}),e.jsx(g,{style:{fontWeight:"bold",color:"white"},color:"danger",onClick:s,children:"Delete Account"})]})]}),ye=()=>{var N;const o=r.useRef(null),n=oe(),{user:s,setUser:c}=re(),i=(N=s==null?void 0:s.avatar)!=null&&N.startsWith("/uploads/")?`http://localhost:5000${s.avatar}`:K,[f,p]=r.useState({}),[x,b]=r.useState(!1),[T,F]=r.useState(i),[k,C]=r.useState(!1),[l,M]=r.useState(""),[h,S]=r.useState({});r.useEffect(()=>{s&&p(s)},[s]);const A=async t=>{const d=t.target.files[0];if(!d)return;const u=new FormData;u.append("avatar",d);try{const y=await fetch("http://localhost:5000/api/users/avatar",{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:u}),P=await y.json();y.ok&&P.avatar?(c({...s,avatar:P.avatar}),alert("Profile Updated!")):alert("Failed to update avatar.")}catch(y){console.error("Avatar upload error:",y),alert("Failed to update avatar.")}},I=t=>{M(t),t==="name"&&S({firstName:s.firstName,lastName:s.lastName}),t==="email"&&S({email:s.email,password:""}),t==="password"&&S({current:"",new:"",confirm:""}),b(!0)},R=async()=>{let t={};if(l==="name"){if(!h.firstName||!h.lastName)return alert("First name and last name are required.");t={firstName:h.firstName,lastName:h.lastName}}else if(l==="email"){if(!h.email||!h.password)return alert("Both email and password are required.");t={email:h.email,password:h.password}}else if(l==="password"){const{current:d,new:u,confirm:y}=h;if(!d||!u||!y)return alert("All password fields are required.");if(u!==y)return alert("New password and confirmation do not match.");if(!/^(?=.*[A-Za-z])(?=.*\d)(?=.*[!$@%])[A-Za-z\d!$@%]{8,}$/.test(u))return alert("Password must be at least 8 characters and include letters, numbers, and special characters (!$@%).");t={currentPassword:d,password:u}}try{const d=await fetch(`http://localhost:5000/api/users/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(t)}),u=await d.json();d.ok?(c({...s,...t}),document.activeElement.blur(),b(!1),alert("Profile updated successfully!")):alert("Error updating account: "+u.error)}catch(d){console.error("Error updating account:",d),alert("Failed to update account.")}},H=async()=>{try{const t=await fetch(`/api/users/${s.id}`,{method:"DELETE"}),d=await t.json();t.ok?(localStorage.removeItem("authToken"),n("/login")):alert("Error deleting account: "+d.error)}catch(t){console.error("Error deleting account:",t)}};return e.jsxs("div",{className:"container",style:{padding:"20px"},children:[e.jsx("h4",{className:"mb-3",children:"Account Settings"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-body-secondary text-decoration-none",style:{cursor:"pointer"},onClick:()=>n("/cards"),children:"DASHBOARD"})," / ",e.jsx("span",{style:{color:"#F28D35"},children:"ACCOUNT SETTINGS"})]}),e.jsx(z,{className:"justify-content-start mb-4",children:e.jsx(O,{md:10,children:e.jsx(Q,{className:"p-3",children:e.jsxs(z,{className:"align-items-center",children:[e.jsx(O,{xs:"auto",children:e.jsx(le,{src:i,size:"xl",alt:"Profile",onError:t=>t.target.src=K})}),e.jsxs(O,{children:[e.jsxs("h5",{className:"mb-1",children:[s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),e.jsx("p",{className:"text-muted mb-0",children:s==null?void 0:s.email})]}),e.jsxs(O,{xs:"auto",className:"text-end",children:[e.jsx("input",{type:"file",accept:"image/*",ref:o,onChange:A,style:{display:"none"}}),e.jsx(g,{style:{fontWeight:"bold",color:"white",backgroundColor:"#F28D35"},size:"sm",onClick:()=>{var t;return(t=o.current)==null?void 0:t.click()},children:"Change Profile Picture"})]})]})})})}),e.jsx(z,{className:"justify-content-start mb-4",children:e.jsx(O,{md:10,children:e.jsxs(Q,{children:[e.jsx(ce,{className:"text-body-secondary",children:e.jsx("strong",{children:"Profile Information"})}),e.jsx(ne,{children:["name","email","password"].map(t=>e.jsxs("div",{className:"text-body-secondary mb-3 d-flex justify-content-between align-items-center",style:{cursor:"pointer"},onClick:()=>I(t),children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[t.charAt(0).toUpperCase()+t.slice(1),":"]}),e.jsx("p",{className:"mb-0",children:t==="name"?`${s==null?void 0:s.firstName} ${s==null?void 0:s.lastName}`:t==="email"?s==null?void 0:s.email:"********"})]}),e.jsx("span",{style:{fontSize:"1.5rem",color:"#adb5bd"},children:"›"})]},t))})]})})}),e.jsx(z,{className:"justify-content-center mt-3",children:e.jsx(O,{md:8,className:"d-flex justify-content-end",children:e.jsx(g,{style:{fontWeight:"bold",color:"white"},color:"danger",onClick:()=>C(!0),children:"Delete Account"})})}),e.jsx(ie,{visible:x,field:l,tempData:h,setTempData:S,onClose:()=>{var t;(t=document.activeElement)==null||t.blur(),b(!1)},onSave:R}),e.jsx(de,{visible:k,onClose:()=>{var t;(t=document.activeElement)==null||t.blur(),C(!1)},onConfirm:H})]})};export{ye as default};
